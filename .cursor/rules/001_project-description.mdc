---
description: Project description and best practices for the Ansible workstation role (playbooks, tasks, defaults)
alwaysApply: true
---

# ansible-workstation ‚Äî Ansible role to configure a workstation

This repository is an **Ansible role** used to configure the user‚Äôs workstation (packages, dev tools, NFS mounts, security, etc.). Main entry: **playbooks/workstation.yml**, which applies the role from the repo root to `localhost` with `become: true`.

<details>
<summary><b>Project directory structure</b></summary>

```
üìÅ .
‚îú‚îÄ‚îÄ ‚öôÔ∏è .cursor/rules/           <- Cursor rules (*.mdc), including Ansible best practices
‚îú‚îÄ‚îÄ ‚ö° .github/workflows/       <- CI (lint, Molecule), Ansible playbook workflow
‚îú‚îÄ‚îÄ üìÅ defaults/                <- Role defaults (main.yml: *_enabled, mount_nfs_entries, etc.)
‚îú‚îÄ‚îÄ üìÅ handlers/                <- Role handlers
‚îú‚îÄ‚îÄ üìÅ meta/                    <- Role metadata, dependencies
‚îú‚îÄ‚îÄ üìÅ molecule/                <- Molecule scenario (e.g. default with converge.yml)
‚îú‚îÄ‚îÄ üìÅ playbooks/               <- Playbooks (workstation.yml runs the role)
‚îú‚îÄ‚îÄ üìÅ tasks/                   <- Role task files (workstation.yml imports them by category)
‚îÇ   ‚îú‚îÄ‚îÄ README.md               <- Task layout and categories
‚îÇ   ‚îú‚îÄ‚îÄ main.yml                <- Entry: imports workstation.yml when workstation_enabled
‚îÇ   ‚îú‚îÄ‚îÄ workstation.yml         <- Main task list (sections 1‚Äì12)
‚îÇ   ‚îú‚îÄ‚îÄ nodejs.yml, git.yml, python.yml, container.yml, ai_tools.yml, ...
‚îÇ   ‚îú‚îÄ‚îÄ mount.yml, keepass.yml, build_tools.yml, storage_disk.yml
‚îÇ   ‚îú‚îÄ‚îÄ system_remove.yml, system_tuning.yml
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ üìÅ templates/               <- Jinja2 templates (if any)
‚îú‚îÄ‚îÄ üìÅ vars/                    <- Role vars (if any)
‚îú‚îÄ‚îÄ üìÑ .ansible-lint             <- ansible-lint config
‚îú‚îÄ‚îÄ üìÑ .pre-commit-config.yaml   <- Hooks: ansible-lint, yamllint, commitlint, etc.
‚îú‚îÄ‚îÄ üìÑ .yamllint                 <- yamllint config (2-space indent, truthy)
‚îú‚îÄ‚îÄ üìÑ requirements.yml          <- Galaxy collections/roles (optional)
‚îî‚îÄ‚îÄ üìÑ README.md, Makefile, ...
```

</details>

## General best practices

- Always look for existing code to iterate on instead of creating new code.
- Do not drastically change patterns before trying to iterate on existing patterns.
- Always prefer simple solutions.
- Avoid duplication of code whenever possible; check for other areas of the codebase that might already have similar code and functionality.
- Only make changes that are requested or that you are confident are well understood and related to the change being requested.
- When fixing an issue or bug, do not introduce a new pattern or technology without first exhausting all options for the existing implementation. If you do introduce something new, remove the old implementation afterwards so we don't have duplicate logic.
- Keep the codebase very clean and organized.
- Avoid writing scripts in files when possible, especially if the script is likely only to be run once.
- Avoid having files over 200‚Äì300 lines of code; refactor at that point.
- Never overwrite `.env` without first asking and confirming.
- Focus on the areas of code relevant to the task; do not touch code that is unrelated to the task.
- Write thorough tests for all major functionality.
- Avoid making major changes to the patterns and architecture of how a feature works after it has shown to work well, unless explicitly instructed.
- Always think about what other methods and areas of code might be affected by code changes.
- Prefer iterating on existing code and patterns instead of introducing new ones.
- Avoid duplication; reuse defaults/vars and shared task patterns (see `tasks/README.md` for categories).
- Prefer simple solutions and the `apt` module with `name`/`state`/`loop` on Debian/Ubuntu.
- Only change what‚Äôs requested or clearly related; don‚Äôt touch unrelated tasks or files.
- When fixing a bug, exhaust existing patterns before adding new ones; if you add something new, remove the old approach so there‚Äôs no duplicate logic.
- Keep tasks and playbooks clean and organized; avoid files growing beyond ~200‚Äì300 lines (split into more task files if needed).
- Do not overwrite `.env` or sensitive config without explicit confirmation.
- Ansible code must pass **ansible-lint** and **yamllint** (enforced by `.pre-commit-config.yaml`); see rule **134_ansible-best-practices.mdc** for details.

## Role and playbook usage

- **Entry point**: `playbooks/workstation.yml` runs the role with `role: ../` and overrides (e.g. `dash_enabled: false`, `apache_create_vhosts: false`). Run with: `ansible-playbook playbooks/workstation.yml -i localhost, --connection=local` (use `-e` or a vars file to set `*_enabled` as needed).
- **Task layout**: `tasks/workstation.yml` is organized by category (system base, editor, desktop, storage, development, cloud, tuning, etc.). New tasks should go in the right category file or a new file imported from `workstation.yml`.
- **Defaults**: Toggles and lists live in `defaults/main.yml` (e.g. `mount_enabled`, `mount_nfs_entries`, `nodejs_enabled`, `ai_tools_enabled`). Prefer adding or tuning variables there instead of hardcoding in tasks.
- **NFS mounts**: Mount points and options are defined in `defaults/main.yml` (`mount_nfs_entries`, `mount_nfs_opts`) and applied in `tasks/mount.yml`.

## Quality and tooling

- **ansible-lint** and **yamllint** run via pre-commit; fix any reported issues before committing.
- Use `pre-commit run --all-files` (or `pre-commit run ansible-lint --all-files` / `pre-commit run yamllint --all-files`) to validate.
- Follow the conventions in **134_ansible-best-practices.mdc** (naming, `loop` vs `with_items`, `ansible_os_family`, FQCN when required, idempotency).

When editing tasks, playbooks, or defaults, keep behavior consistent with existing categories and variable naming; preserve idempotency and avoid breaking existing `*_enabled` toggles.
